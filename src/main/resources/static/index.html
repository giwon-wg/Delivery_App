<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì—¬ê¸°ìš”! ë¡œì»¬ ë§›ì§‘</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fefefe;
            margin: 0;
            padding: 40px;
            text-align: center;
            color: #333;
        }

        h1 {
            font-size: 2.2rem;
            color: #ff4d4f;
            margin-bottom: 20px;
        }

        .section {
            margin-bottom: 40px;
        }

        .card {
            background: #fff;
            padding: 25px 30px;
            border-radius: 16px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            max-width: 420px;
            margin: 0 auto;
        }

        .card img {
            max-width: 150px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        #slogan {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 10px 0;
        }

        #menu {
            font-size: 1rem;
            color: #666;
        }

        .login-box input {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .login-box button {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            background-color: #ff4d4f;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .login-box .sub-buttons {
            display: flex;
            justify-content: space-between;
        }

        .login-box .sub-buttons button {
            width: 48%;
            font-size: 0.9rem;
            background-color: #ddd;
            color: #333;
        }

        .button-group {
            margin-top: 20px;
        }

        .button-group button {
            margin: 5px;
            padding: 10px 16px;
            border-radius: 20px;
            border: 1px solid #ff4d4f;
            color: #ff4d4f;
            background-color: #fff;
            cursor: pointer;
        }

        .button-group button:hover {
            background-color: #ff4d4f;
            color: #fff;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 12px;
            width: 300px;
            text-align: center;
        }

        .modal-content input {
            width: 90%;
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .modal-content button {
            padding: 10px 16px;
            background-color: #ff4d4f;
            color: white;
            border: none;
            border-radius: 6px;
            margin-top: 10px;
        }

        .close {
            float: right;
            font-size: 22px;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 500px) {
            .card, .modal-content {
                width: 90%;
            }
        }
    </style>
</head>
<body>

<!-- ì§€ì—­ ì¶”ì²œ ë°•ìŠ¤ -->
<div class="section">
    <h1>ì—¬ê¸°ìš”!</h1>
    <div class="card">
        <p id="region">ì§€ì—­: ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        <img id="logo" src="" alt="ë¡œê³  ì´ë¯¸ì§€" style="display: none;">
        <p id="slogan"></p>
        <p id="menu"></p>
    </div>
</div>

<!-- ë¡œê·¸ì¸ ë°•ìŠ¤ -->
<div class="section login-box card">
    <input type="text" id="login-email" placeholder="ì´ë©”ì¼">
    <input type="password" id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button onclick="submitLogin()">ë¡œê·¸ì¸</button>

    <div class="sub-buttons">
        <button onclick="location.href='/oauth2/authorization/google'">ì†Œì…œ ë¡œê·¸ì¸</button>
        <button onclick="openSignupModal()">íšŒì›ê°€ì…</button>
    </div>
</div>

<!-- ì§€ì—­ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ -->
<div class="section">
    <h3>ğŸ§ª í…ŒìŠ¤íŠ¸ ì§€ì—­ ì„ íƒ</h3>

    <div style="margin-bottom: 10px; font-weight: bold;">ê´‘ì—­ì‹œ / íŠ¹ë³„ì‹œ</div>
    <div class="button-group">
        <button onclick="testRegion(37.5665, 126.9780)">ì„œìš¸</button>
        <button onclick="testRegion(35.1796, 129.0756)">ë¶€ì‚°</button>
        <button onclick="testRegion(35.8722, 128.6025)">ëŒ€êµ¬</button>
        <button onclick="testRegion(37.4563, 126.7052)">ì¸ì²œ</button>
        <button onclick="testRegion(35.1595, 126.8526)">ê´‘ì£¼</button>
        <button onclick="testRegion(36.3504, 127.3845)">ëŒ€ì „</button>
        <button onclick="testRegion(35.5384, 129.3114)">ìš¸ì‚°</button>
        <button onclick="testRegion(36.4800, 127.2890)">ì„¸ì¢…</button>
    </div>

    <div style="margin: 20px 0 10px; font-weight: bold;">ë„ ì§€ì—­</div>
    <div class="button-group">
        <button onclick="testRegion(37.4138, 127.5183)">ê²½ê¸°</button>
        <button onclick="testRegion(37.8228, 128.1555)">ê°•ì›</button>
        <button onclick="testRegion(36.6358, 127.4917)">ì¶©ë¶</button>
        <button onclick="testRegion(36.5184, 126.8000)">ì¶©ë‚¨</button>
        <button onclick="testRegion(35.7175, 127.1530)">ì „ë¶</button>
        <button onclick="testRegion(34.8161, 126.4630)">ì „ë‚¨</button>
        <button onclick="testRegion(36.4919, 128.8889)">ê²½ë¶</button>
        <button onclick="testRegion(35.4606, 128.2132)">ê²½ë‚¨</button>
        <button onclick="testRegion(33.4996, 126.5312)">ì œì£¼</button>
    </div>
</div>

<!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->
<div id="signupModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeSignupModal()">&times;</span>
        <h3>íšŒì›ê°€ì…</h3>
        <input type="text" id="signup-email" placeholder="ì´ë©”ì¼">
        <input type="password" id="signup-password" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <input type="text" id="signup-nickname" placeholder="ë‹‰ë„¤ì„">
        <input type="text" id="signup-address" placeholder="ì£¼ì†Œ">
        <button onclick="submitSignup()">ê°€ì…í•˜ê¸°</button>
    </div>
</div>

<script>
    function updateUI(data, test = false) {
        document.getElementById("region").innerText = `ì§€ì—­: ${data.region}`;
        document.getElementById("logo").src = data.logo_url;
        document.getElementById("logo").style.display = "block";
        document.getElementById("slogan").innerText = data.slogan;
        document.getElementById("menu").innerText = `ì¶”ì²œë©”ë‰´: ${data.recommended_menu}`;
    }

    function testRegion(lat, lng) {
        fetch(`/api/region?lat=${lat}&lng=${lng}`)
            .then(res => res.json())
            .then(data => updateUI(data, true))
            .catch(() => {
                document.getElementById("region").innerText = "ì§€ì—­ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
            });
    }

    navigator.geolocation.getCurrentPosition(
        (pos) => {
            fetch(`/api/region?lat=${pos.coords.latitude}&lng=${pos.coords.longitude}`)
                .then(res => res.json())
                .then(data => updateUI(data))
                .catch(() => {
                    document.getElementById("region").innerText = "ì§€ì—­ ì •ë³´ ì‹¤íŒ¨";
                });
        },
        () => {
            document.getElementById("region").innerText = "ìœ„ì¹˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.";
        }
    );

    function submitLogin() {
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        })
            .then(res => {
                if (!res.ok) return res.json().then(err => { throw new Error(err.message); });
                return res.json();
            })
            .then(data => {
                const tokenData = data.data;
                localStorage.setItem('accessToken', tokenData.access_token);
                localStorage.setItem('refreshToken', tokenData.refresh_token);
                window.location.href = "/home.html";
            })
            .catch(err => {
                alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + err.message);
            });
    }

    function openSignupModal() {
        document.getElementById('signupModal').style.display = 'block';
    }

    function closeSignupModal() {
        document.getElementById('signupModal').style.display = 'none';
    }

    function submitSignup() {
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;
        const nickname = document.getElementById('signup-nickname').value;
        const address = document.getElementById('signup-address').value;

        fetch('/api/auth/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password, nickname, address })
        })
            .then(res => {
                if (res.ok) {
                    alert('íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    closeSignupModal();
                } else {
                    return res.json().then(err => { throw new Error(err.message); });
                }
            })
            .catch(err => {
                alert('âŒ íšŒì›ê°€ì… ì‹¤íŒ¨: ' + err.message);
            });
    }

</script>

</body>
</html>
